{% extends 'navbar.html' %}
{% load static %}
{% load allauth %}
{% load i18n %}

{% block head_title %}
    {% trans "Password Change" %}
{% endblock head_title %}

{% block content %}
<section class="login_box_area section_gap" style="padding-top: 170px;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-4">
                <div class="login_form_inner text-center" style="box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); padding: 30px; border-radius: 10px;">
                    <h3 class="mb-3" style="font-weight: 600;">{% trans "Change Password" %}</h3>

                    {% if token_fail %}
                        <div class="alert alert-danger">
                            <p>{% trans "The password reset link is invalid or has already been used." %}</p>
                            <a href="{% url 'account_reset_password' %}" class="btn btn-primary" style="background: linear-gradient(to right, #FFA500, #FF4500); border: none;">
                                {% trans "Request New Password Reset" %}
                            </a>
                        </div>
                    {% else %}
                        <form method="post" action="{{ action_url }}" class="text-start" id="password-reset-form">
                            {% csrf_token %}
                            {{ redirect_field }}

                            <div class="form-group mt-3">
                                <label for="id_password1" style="font-weight: 500;">{% trans "New Password" %}</label>
                                <input type="password" class="form-control" name="password1" id="id_password1" required style="border-radius: 5px; border: 1px solid #ddd; padding: 10px;">
                                <small id="password1-error" class="text-danger"></small>
                            </div>

                            <div class="form-group mt-3">
                                <label for="id_password2" style="font-weight: 500;">{% trans "New Password (again)" %}</label>
                                <input type="password" class="form-control" name="password2" id="id_password2" required style="border-radius: 5px; border: 1px solid #ddd; padding: 10px;">
                                <small id="password2-error" class="text-danger"></small>
                            </div>

                            <div class="form-group form-check mt-3">
                                <input type="checkbox" class="form-check-input" id="keep_logged_in">
                                <label class="form-check-label" for="keep_logged_in" style="color: #777;">Keep me logged in</label>
                            </div>

                            <div class="mt-4">
                                <button type="submit" class="btn btn-primary change-password-btn" style="width: 100%; background: linear-gradient(to right, #FFA500, #FF4500); border: none; padding: 12px; font-weight: 600;">
                                    {% trans "Change Password" %}
                                </button>
                            </div>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% block js %}
<script>
    document.getElementById("password-reset-form").addEventListener("submit", function(event) {
        let password1 = document.getElementById("id_password1").value;
        let password2 = document.getElementById("id_password2").value;
        let password1Error = document.getElementById("password1-error");
        let password2Error = document.getElementById("password2-error");

        password1Error.textContent = "";
        password2Error.textContent = "";

        if (password1.length < 8) {
            password1Error.textContent = "Password must be at least 8 characters long.";
            event.preventDefault();
        }

        if (password1 !== password2) {
            password2Error.textContent = "Passwords do not match.";
            event.preventDefault();
        }
    });
</script>
    {% endblock js %}
{% endblock content %}