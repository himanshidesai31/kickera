{% extends 'navbar.html' %}
{% load static %}
{% load allauth %}
{% load i18n %}

{% block head_title %}{% trans "Reset Password" %}{% endblock head_title %}

{% block content %}
<br>
<br>
<section class="d-flex align-items-center justify-content-center" 
         style="min-height: 80vh; background-color: #f9f9f9; padding-top: 100px;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-7">
                <div class="card shadow-lg border-0 rounded-lg p-5 bg-white text-center">
                    
                    <h3 class="text-secoundary mb-3">{% trans "Reset Your Password" %}</h3>

                    {% if token_fail %}
                        <div class="alert alert-danger">
                            <p>{% trans "The password reset link is invalid or has already been used." %}</p>
                            <a href="{% url 'account_reset_password' %}" 
                               class="btn btn-primary"
                               style="background: linear-gradient(to right, #FF4500, #FFA500); 
                                      border: none; font-weight: 600;">
                                {% trans "Request New Password Reset" %}
                            </a>
                        </div>
                    {% else %}
                        <form method="post" action="{{ action_url }}" class="text-start" id="password-reset-form">
                            {% csrf_token %}
                            {{ redirect_field }}

                            <div class="form-group mt-3 position-relative">
                                <label for="id_password1" class="form-label">{% trans "New Password" %}</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" name="password1" id="id_password1" 
                                           required style="border-radius: 5px; border: 1px solid #ddd; padding: 10px;">
                                   
                                </div>
                                <small id="password1-error" class="text-danger"></small>
                            </div>

                            <div class="form-group mt-3 position-relative">
                                <label for="id_password2" class="form-label">{% trans "Confirm New Password" %}</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" name="password2" id="id_password2" 
                                           required style="border-radius: 5px; border: 1px solid #ddd; padding: 10px;">
                                    
                                </div>
                                <small id="password2-error" class="text-danger"></small>
                            </div>

                            <div class="form-group form-check mt-3">
                                <input type="checkbox" class="form-check-input" id="keep_logged_in">
                                <label class="form-check-label text-muted" for="keep_logged_in">
                                    {% trans "Keep me logged in" %}
                                </label>
                            </div>

                            <div class="mt-4">
                                <button type="submit" class="btn btn-primary change-password-btn w-100" 
                                        style="background: linear-gradient(to right, #FF4500, #FFA500); 
                                               border: none; padding: 12px; font-weight: 600;">
                                    {% trans "Change Password" %}
                                </button>
                            </div>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
<br>

{% block js %}
<script>
    document.getElementById("password-reset-form").addEventListener("submit", function(event) {
        let password1 = document.getElementById("id_password1").value;
        let password2 = document.getElementById("id_password2").value;
        let password1Error = document.getElementById("password1-error");
        let password2Error = document.getElementById("password2-error");

        password1Error.textContent = "";
        password2Error.textContent = "";

        if (password1.length < 8) {
            password1Error.textContent = "Password must be at least 8 characters long.";
            event.preventDefault();
        }

        if (password1 !== password2) {
            password2Error.textContent = "Passwords do not match.";
            event.preventDefault();
        }
    });

    function togglePassword(id) {
        let input = document.getElementById(id);
        input.type = input.type === "password" ? "text" : "password";
    }
</script>
{% endblock js %}

{% endblock content %}
