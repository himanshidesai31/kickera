{% extends 'navbar.html' %}
{% load static %}
{% block title %}
Product Categories
{% endblock title %}
{% block content %}

<section class="banner-area organic-breadcrumb">
	<div class="container">
		<div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
			<div class="col-first">
				<h1>Shop Category </h1>
				<nav class="d-flex align-items-center">
					<a href="{% url 'index' %}">Home<span class="lnr lnr-arrow-right"></span></a>
					<a href="{% url 'category_list' %}">Product Categories</a>
				</nav>
			</div>
		</div>
	</div>
</section>
<!-- End Banner Area -->
<div class="container">
	<div class="row">
		<div class="col-xl-3 col-lg-4 col-md-5">
			<div class="sidebar-categories">
				<div class="head">Browse Categories</div>
				<ul class="main-categories">
					{% for category in categories %}
					<li class="main-nav-list">
						<a href="{% url 'category_list' %}?category={{ category.id }}" class="{% if current_filters.category|stringformat:'s' == category.id|stringformat:'s' %}active{% endif %}">
							<span class="lnr lnr-arrow-right"></span>{{ category.category_name }}
							<span class="number">({{ category.product_set.count }})</span>
						</a>
					</li>
					{% empty %}
					<li class="main-nav-list">No categories found</li>
					{% endfor %}
				</ul>
			</div>
			<div class="sidebar-filter mt-50">
				<div class="top-filter-head">Product Filters</div>
				<form id="filter-form" method="GET" action="{% url 'category_list' %}">
					{% if current_filters.category %}
					<input type="hidden" name="category" value="{{ current_filters.category }}">
					{% endif %}
					
					<div class="common-filter">
						<div class="head">Brands</div>
						<ul>
							{% for brand in brands %}
							<li class="filter-list">
								<input class="pixel-radio" type="radio" id="brand-{{ brand.id }}" 
									name="brand" value="{{ brand.id }}" 
									{% if current_filters.brand|stringformat:'s' == brand.id|stringformat:'s' %}checked{% endif %}>
								<label for="brand-{{ brand.id }}">{{ brand.brand_name }}</label>
							</li>
							{% empty %}
							<li class="filter-list">No brands found</li>
							{% endfor %}
						</ul>
					</div>
					
					<div class="common-filter">
						<div class="head">Product Type</div>
						<ul>
							<li class="filter-list">
								<input class="pixel-radio" type="radio" id="type-latest" 
									name="product_type" value="latest"
									{% if current_filters.product_type == 'latest' %}checked{% endif %}>
								<label for="type-latest">Latest</label>
							</li>
							<li class="filter-list">
								<input class="pixel-radio" type="radio" id="type-coming" 
									name="product_type" value="coming"
									{% if current_filters.product_type == 'coming' %}checked{% endif %}>
								<label for="type-coming">Coming Soon</label>
							</li>
						</ul>
					</div>
					
					<div class="common-filter">
						<div class="head">Price Range</div>
						<div class="price-range-area">
							<div class="price-range-div">
								<label for="min_price">Min Price:</label>
								<input type="number" id="min_price" name="min_price" value="{{ min_price }}" 
									min="0" class="form-control" placeholder="Min Price">
							</div>
							<div class="price-range-div mt-2">
								<label for="max_price">Max Price:</label>
								<input type="number" id="max_price" name="max_price" value="{{ max_price }}" 
									min="0" class="form-control" placeholder="Max Price">
							</div>
						</div>
					</div>
					
					<div class="mt-3 text-center">
						<button type="submit" class="primary-btn">Apply Filters</button>
						<a href="{% url 'category_list' %}" class="gray-btn mt-2">Clear Filters</a>
					</div>
				</form>
			</div>
		</div>
		<div class="col-xl-9 col-lg-8 col-md-7">
			<!-- Start Filter Bar -->
			<div class="filter-bar d-flex flex-wrap align-items-center">
				<div class="sorting">
					<form id="sort-form" method="GET" action="{% url 'category_list' %}">
						{% for key, value in current_filters.items %}
							{% if key != 'sort_by' and key != 'sort_order' and key != 'page' %}
							<input type="hidden" name="{{ key }}" value="{{ value }}">
							{% endif %}
						{% endfor %}
						<select name="sort_by" onchange="document.getElementById('sort-form').submit()">
							<option value="name" {% if sort_by == 'name' %}selected{% endif %}>Sort by name</option>
							<option value="price" {% if sort_by == 'price' %}selected{% endif %}>Sort by price</option>
							<option value="product_type" {% if sort_by == 'product_type' %}selected{% endif %}>Sort by type</option>
						</select>
						<select name="sort_order" onchange="document.getElementById('sort-form').submit()">
							<option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>Ascending</option>
							<option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>Descending</option>
						</select>
					</form>
				</div>
				<div class="sorting mr-auto">
					<span>Showing {{ page_obj.start_index }} to {{ page_obj.end_index }} of {{ paginator.count }} results</span>
				</div>
			</div>
			<!-- End Filter Bar -->
			
			<!-- Start Product List -->
			<section class="lattest-product-area pb-40 category-list">
				<div class="row">
                    {% for product in products %}
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="single-product">
                            {% if product.images.exists %}
                                <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="img-fluid">
                            {% else %}
                                <div class="no-image-placeholder">No Image Available</div>
                            {% endif %}

                            <div class="product-details">
                                <h6>{{ product.name }}</h6>
                                <div class="price">
                                    <h6>₹{{ product.price }}</h6>
                                    {% if product.original_price %}
                                    <h6 class="l-through">₹{{ product.original_price }}</h6>
                                    {% endif %}
                                </div>
                                <div class="prd-bottom">
                                    <form id="cart-form-{{ product.pk }}" action="{% url 'cart_add' product.pk %}" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="next" value="{{ request.get_full_path }}">
                                        <button type="submit" style="display: none;"></button>
                                        <a href="#" class="social-info" onclick="document.getElementById('cart-form-{{ product.pk }}').submit(); return false;">
                                            <p class="hover-text">Add to Cart</p>
                                            <span class="ti-bag"></span>
                                        </a>
                                    </form>
                                    <form id="wish-form-{{ product.pk }}" action="{% url 'add_wishlist' product.pk %}" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="next" value="{{ request.get_full_path }}">
                                        <button type="submit" style="display: none;"></button>
                                        <a href="#" class="social-info" onclick="document.getElementById('wish-form-{{ product.pk }}').submit(); return false;">
                                            <span class="lnr lnr-heart"></span>
                                            <p class="hover-text">Wishlist</p>
                                        </a>
                                    </form>
                                    <form id="buy-now-form-{{ product.pk }}" action="{% url 'cart_add' product.pk %}" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="next" value="{% url 'checkout' %}">
                                        <button type="submit" style="display: none;"></button>
                                        <a href="#" class="social-info" onclick="document.getElementById('buy-now-form-{{ product.pk }}').submit(); return false;">
                                            <span class="lnr lnr-cart"></span>
                                            <p class="hover-text">Buy Now</p>
                                        </a>
                                    </form>
                                    <a href="{% url 'product_detail' product.pk %}" class="social-info">
                                        <span class="lnr lnr-move"></span>
                                        <p class="hover-text">View More</p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12 text-center py-5">
                        <h3>No products found matching your criteria</h3>
                        <p>Try adjusting your filters or <a href="{% url 'category_list' %}">browse all products</a></p>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                {% if is_paginated %}
                <div class="row">
                    <div class="col-12">
                        <nav class="cat_page">
                            <ul class="pagination justify-content-center">
                                {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?{% for key, value in current_filters.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page=1">First</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?{% for key, value in current_filters.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}">Previous</a>
                                </li>
                                {% endif %}
                
                                {% for num in paginator.page_range %}
                                    {% if page_obj.number == num %}
                                    <li class="page-item active">
                                        <a class="page-link" href="?{% for key, value in current_filters.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ num }}">{{ num }}</a>
                                    </li>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                    <li class="page-item">
                                        <a class="page-link" href="?{% for key, value in current_filters.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ num }}">{{ num }}</a>
                                    </li>
                                    {% endif %}
                                {% endfor %}
                
                                {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?{% for key, value in current_filters.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}">Next</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?{% for key, value in current_filters.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ paginator.num_pages }}">Last</a>
                                </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                </div>
                {% endif %}
            </section>
            <!-- End Product List -->
		</div>
	</div>
</div>

{% block extra_css %}
<style>
    .no-image-placeholder {
        height: 200px;
        background-color: #f5f5f5;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #888;
    }
    .price-range-div {
        margin: 10px 0;
    }
    .gray-btn {
        display: inline-block;
        padding: 8px 20px;
        background: #e0e0e0;
        color: #333;
        border-radius: 30px;
        text-decoration: none;
    }
    .gray-btn:hover {
        background: #d0d0d0;
        color: #333;
        text-decoration: none;
    }
    .active {
        color: #ff6c00 !important;
        font-weight: bold;
    }
</style>
{% endblock %}

{% endblock content %}